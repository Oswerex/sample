<!DOCTYPE html>
<html lang="fil">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Safety Training with Assessment</title>

<style>
:root {
    --primary:#0b5fff;
    --danger:#cc0033;
    --success:#1a7f37;
    --muted:#666;
    --card-bg:#ffffffcc;
    --bg:#e9efff;
}
body {
    background: linear-gradient(135deg,#0b5fff33,#ffffff);
    font-family: Arial, sans-serif;
    margin:0;
    padding:20px;
    line-height:1.5;
}
.container { max-width:900px; margin:auto; }
.card {
    background: var(--card-bg);
    backdrop-filter: blur(6px);
    border-radius:10px;
    padding:20px;
    box-shadow:0 3px 12px rgba(0,0,0,0.12);
    margin-top:20px;
}
.hidden { display:none; }
.btn { padding:10px 16px; border:none; border-radius:6px; cursor:pointer; font-weight:600; }
.btn-primary { background: var(--primary); color:#fff; }
.btn-muted { background:#e5e5e5; color:#333; }

input[type="text"] {
    padding:8px;
    border:1px solid #ccc;
    border-radius:6px;
    width:250px;
}

.orientation-container {
    text-align:center;
}
.orientation-img {
    max-width:100%;
    border-radius:10px;
    margin-bottom:10px;
}
.orientation-controls {
    display:flex;
    justify-content:center;
    gap:10px;
}

.question { font-weight:600; margin-bottom:6px; }
.question-block { margin-bottom:18px; }
</style>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
<div class="container">

<h2>Safety Orientation</h2>

<!-- IMAGE ORIENTATION -->
<div class="card orientation-card">
    <h3>Note: Please view all slides until the end to start the assessment</h3>
    <div class="orientation-container">
        <img id="slideImg" class="orientation-img" src="assets/slide1.jpg" alt="Orientation Slide">
    </div>
    <div class="orientation-controls">
        <button id="prevSlideBtn" class="btn btn-muted" disabled>Previous</button>
        <button id="nextSlideBtn" class="btn btn-primary">Next</button>
    </div>
</div>

<div class="card">
    <label>
        <input type="checkbox" id="watchedChk" disabled> I confirm that I have viewed all slides.
    </label>
    <br><br>
    <button id="startBtn" class="btn btn-primary" disabled>Start Assessment</button>
    <button id="resetBtn" class="btn btn-muted hidden">Reset</button>
</div>

<!-- ASSESSMENT -->
<div id="assessment" class="card hidden">
    <h3>Assessment</h3>

    <!-- 10 QUESTIONS -->
    <div class="question-block">
        <label class="question">1. Gaano katagal ang bisa ng Work Permit para sa High-Risk na trabaho?</label><br>
        <label><input type="radio" name="q1" value="1 araw"> 1 araw</label><br>
        <label><input type="radio" name="q1" value="1 linggo"> 1 linggo</label><br>
        <label><input type="radio" name="q1" value="1 buwan"> 1 buwan</label><br>
        <label><input type="radio" name="q1" value="6 na buwan"> 6 na buwan</label>
    </div>

    <div class="question-block">
        <label class="question">2. Anong dokumento ang kailangan kasama ng Work Permit para sa High-Risk na trabaho?</label><br>
        <label><input type="radio" name="q2" value="JHA"> Job Hazard Analysis (JHA)</label><br>
        <label><input type="radio" name="q2" value="MSDS"> MSDS</label><br>
        <label><input type="radio" name="q2" value="Permit"> Work Permit lamang</label><br>
        <label><input type="radio" name="q2" value="Checklist"> Safety Checklist</label>
    </div>

    <div class="question-block">
        <label class="question">3. Sino ang dapat naroon bago magsimula ang High-Risk na aktibidad?</label><br>
        <label><input type="radio" name="q3" value="Worker"> Worker lamang</label><br>
        <label><input type="radio" name="q3" value="Safety Officer o Supervisor"> Safety Officer o Supervisor</label><br>
        <label><input type="radio" name="q3" value="Engineer"> Engineer</label><br>
        <label><input type="radio" name="q3" value="Manager"> Manager</label>
    </div>

    <div class="question-block">
        <label class="question">4. Ano ang maximum speed limit sa loob ng Meralco Operating Center?</label><br>
        <label><input type="radio" name="q4" value="20 KPH"> 20 KPH</label><br>
        <label><input type="radio" name="q4" value="30 KPH"> 30 KPH</label><br>
        <label><input type="radio" name="q4" value="40 KPH"> 40 KPH</label><br>
        <label><input type="radio" name="q4" value="50 KPH"> 50 KPH</label>
    </div>

    <div class="question-block">
        <label class="question">5. Ano ang unang bawal ayon sa Fire Safety Rules ng Meralco?</label><br>
        <label><input type="radio" name="q5" value="Paninigarilyo"> Paninigarilyo</label><br>
        <label><input type="radio" name="q5" value="Open Flames"> Open Flames</label><br>
        <label><input type="radio" name="q5" value="Running"> Running</label><br>
        <label><input type="radio" name="q5" value="Eating"> Eating</label>
    </div>

    <div class="question-block">
        <label class="question">6. Ano ang unang dapat gawin kapag may lindol?</label><br>
        <label><input type="radio" name="q6" value="Run"> Tumakbo palabas</label><br>
        <label><input type="radio" name="q6" value="Duck – Cover – Hold"> Duck – Cover – Hold</label><br>
        <label><input type="radio" name="q6" value="Hide"> Magtago sa ilalim ng mesa</label><br>
        <label><input type="radio" name="q6" value="Call"> Tumawag sa supervisor</label>
    </div>

    <div class="question-block">
        <label class="question">7. Kung ikaw ay Heavy Equipment Operator, anong dokumento ang dapat meron ka?</label><br>
        <label><input type="radio" name="q7" value="License"> Driver's License</label><br>
        <label><input type="radio" name="q7" value="Heavy Equipment NC II Certification"> Heavy Equipment NC II Certification</label><br>
        <label><input type="radio" name="q7" value="Permit"> Work Permit lamang</label><br>
        <label><input type="radio" name="q7" value="Safety Checklist"> Safety Checklist</label>
    </div>

    <div class="question-block">
        <label class="question">8. Saan ang Emergency Assembly Point sa Area 2?</label><br>
        <label><input type="radio" name="q8" value="Sa harap ng parking ng Technical Service Building"> Sa harap ng parking ng Technical Service Building</label><br>
        <label><input type="radio" name="q8" value="Sa opisina"> Sa opisina</label><br>
        <label><input type="radio" name="q8" value="Sa kanto"> Sa kanto</label><br>
        <label><input type="radio" name="q8" value="Sa gate"> Sa gate</label>
    </div>

    <div class="question-block">
        <label class="question">9. Anong dokumento ang dapat palaging dala kapag may aktibidad sa loob ng Meralco?</label><br>
        <label><input type="radio" name="q9" value="Approved Work Permit"> Approved Work Permit</label><br>
        <label><input type="radio" name="q9" value="ID"> ID</label><br>
        <label><input type="radio" name="q9" value="Safety Checklist"> Safety Checklist</label><br>
        <label><input type="radio" name="q9" value="License"> License</label>
    </div>

    <div class="question-block">
        <label class="question">10. Anong materyales ang bawal dalhin sa loob ng Meralco Operating Center?</label><br>
        <label><input type="radio" name="q10" value="Single-Use Plastics"> Single-Use Plastics</label><br>
        <label><input type="radio" name="q10" value="Food"> Food</label><br>
        <label><input type="radio" name="q10" value="Bags"> Bags</label><br>
        <label><input type="radio" name="q10" value="Electronics"> Electronics</label>
    </div>

    <div class="question-block">
        <label class="question">Name:</label><br>
        <input type="text" id="traineeName" placeholder="Juan Dela Cruz">
    </div>

    <button id="submitBtn" class="btn btn-primary">Submit</button>
    <button id="retakeBtn" class="btn btn-muted hidden">Retake Assessment</button>
</div>

<div id="result" class="card hidden"></div>

</div>

<script>
// --- IMAGE ORIENTATION LOGIC ---
const slides = [];
for(let i=1;i<=26;i++) slides.push(`assets/slide${i}.jpg`);

let currentSlide = 0;

const slideImg = document.getElementById('slideImg');
const prevSlideBtn = document.getElementById('prevSlideBtn');
const nextSlideBtn = document.getElementById('nextSlideBtn');
const watchedChk = document.getElementById('watchedChk');
const startBtn = document.getElementById('startBtn');
const assessment = document.getElementById('assessment');
const resetBtn = document.getElementById('resetBtn');
const submitBtn = document.getElementById('submitBtn');
const retakeBtn = document.getElementById('retakeBtn');
const resultDiv = document.getElementById('result');

let attemptCount = 1;

function updateSlide() {
    slideImg.src = slides[currentSlide];
    prevSlideBtn.disabled = currentSlide === 0;
    nextSlideBtn.disabled = currentSlide === slides.length - 1;
    watchedChk.disabled = currentSlide !== slides.length - 1;
    if (!watchedChk.disabled) watchedChk.checked = false;
}

prevSlideBtn.addEventListener('click', () => { if(currentSlide>0) currentSlide--; updateSlide(); });
nextSlideBtn.addEventListener('click', () => { if(currentSlide<slides.length-1) currentSlide++; updateSlide(); });

watchedChk.addEventListener('change', () => { startBtn.disabled = !watchedChk.checked; });

startBtn.addEventListener('click', () => {
    assessment.classList.remove('hidden');
    resetBtn.classList.remove('hidden');
    resultDiv.classList.add('hidden');
});

resetBtn.addEventListener('click', resetAll);
retakeBtn.addEventListener('click', () => { attemptCount++; resetAll(); });

function resetAll(){
    for(let i=1;i<=10;i++){
        let c=document.querySelector(`input[name="q${i}"]:checked`);
        if(c) c.checked=false;
    }
    document.getElementById('traineeName').value="";
    resultDiv.innerHTML="";
    resultDiv.classList.add('hidden');
}

// --- ASSESSMENT SUBMIT LOGIC ---
submitBtn.addEventListener('click', async () => {
    let score=0;
    if(document.querySelector('input[name="q1"]:checked')?.value==="1 buwan") score++;
    if(document.querySelector('input[name="q2"]:checked')?.value==="JHA") score++;
    if(document.querySelector('input[name="q3"]:checked')?.value==="Safety Officer o Supervisor") score++;
    if(document.querySelector('input[name="q4"]:checked')?.value==="30 KPH") score++;
    if(document.querySelector('input[name="q5"]:checked')?.value==="Paninigarilyo") score++;
    if(document.querySelector('input[name="q6"]:checked')?.value==="Duck – Cover – Hold") score++;
    if(document.querySelector('input[name="q7"]:checked')?.value==="Heavy Equipment NC II Certification") score++;
    if(document.querySelector('input[name="q8"]:checked')?.value==="Sa harap ng parking ng Technical Service Building") score++;
    if(document.querySelector('input[name="q9"]:checked')?.value==="Approved Work Permit") score++;
    if(document.querySelector('input[name="q10"]:checked')?.value==="Single-Use Plastics") score++;

    let name = document.getElementById('traineeName').value.trim();
    if(!name) return alert("Pakilagay ang pangalan.");

    let result = (score===10) ? "PASS" : "FAIL";

    // Google Sheet POST
    const APP_SCRIPT_URL="https://script.google.com/macros/s/AKfycbyBql2dvKoJ0IuzXEXOAhsgABQy1_il_bFJrXPMB1EbMvqyOVvhLckFZaMRZAsx6TpZ/exec";
    const SECRET="V9x!7Qm#4sP@2kT8zL$1gR";
    try{
        await fetch(APP_SCRIPT_URL,{
            method:"POST",
            mode:"no-cors",
            headers:{ "Content-Type":"application/json" },
            body:JSON.stringify({ token:SECRET, name:name, score:score, result:result, attempts:attemptCount })
        });
    }catch(e){}

    resultDiv.classList.remove('hidden');
    if(result==="PASS"){
        resultDiv.innerHTML="<h3 class='result-pass'>PASADO!</h3><p>Generating certificate…</p>";
        generateCertificate(name);
        retakeBtn.classList.add('hidden');
    } else {
        resultDiv.innerHTML="<h3 class='result-fail'>You FAILED.</h3><p>Try again.</p>";
        retakeBtn.classList.remove('hidden');
    }
});

// --- CERTIFICATE FUNCTION ---
async function generateCertificate(name){
    const {jsPDF}=window.jspdf;
    const doc=new jsPDF({unit:"pt",format:"a4"});

    doc.setFillColor(255,140,0);
    doc.rect(0,0,595,80,'F');

    const img = new Image();
    img.src="https://raw.githubusercontent.com/Oswerex/ESH/6acfa4af336cce3696a01fea102eeaa626a67e01/ESHM%20Logo.png";
    img.onload=function(){
        doc.addImage(img,'PNG',241,10,108,72);
        doc.setFontSize(28);
        doc.setTextColor(0,0,0);
        doc.text("Certificate of Completion",300,120,{align:"center"});
        doc.setFontSize(16);
        doc.text("This certifies that:", 300, 210, { align: "center" });
        doc.setFontSize(24);
        doc.text(name.toUpperCase(), 300, 245, { align: "center" });
        doc.setFontSize(14);
        doc.text("Successfully completed the Safety Orientation Assessment",300,285,{align:"center"});
        doc.save(`Certificate_${name}.pdf`);
    }
}

// initialize first slide
updateSlide();
</script>

</body>
</html>
